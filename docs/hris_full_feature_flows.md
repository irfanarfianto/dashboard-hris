# Flow Fitur HRIS Admin Dashboard (37 Tabel - Next.js/Supabase)

Dokumen ini memetakan alur kerja setiap fitur di Admin Dashboard HRIS, membagi tanggung jawab implementasi berdasarkan jenis komponen Next.js untuk memastikan keamanan, efisiensi, dan integrasi yang benar dengan Supabase (melalui RLS dan Server Actions).

## üéØ Modul 1: Manajemen Data Master & Akun (Tabel A, G)

| Fitur                                | Komponen Kunci & Tugas                                                                                                                                                 | Data Flow / Supabase Query                                                                                                                                                                                                                                                                                                               |
| :----------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1.1. Daftar Karyawan Aktif**       | **Server Component:** `app/dashboard/employees/page.tsx`                                                                                                               | **Fetch:** `from('employees').select('*, departments(name), positions(name)').is('deleted_at', null).eq('status', 'Active').order('full_name')`                                                                                                                                                                                          |
| **1.2. Tambah Karyawan Baru**        | **Client Component:** Form multi-step (Karyawan Dasar, Detail Personel, Dokumen).<br>**Server Action:** `employeeActions.ts`                                           | **Mutasi (Server Action):** 1. **Insert** ke `employees`. 2. **Insert** ke `users` (dengan `employee_id` baru, _hash_ password sementara, `role_id`). 3. **Insert** ke `employee_personnel_details` (wajib 1:1). 4. **Insert** ke `onboarding_tokens`. 5. Panggil API/Function untuk **Insert** ke `whatsapp_logs`. 6. `revalidatePath`. |
| **1.3. Edit Data Karyawan**          | **Client Component:** Form Edit (Populasi data lama).<br>**Server Action:** `employeeActions.ts`                                                                       | **Mutasi (Server Action):** 1. **Update** `employees`. 2. **Upsert** `employee_personnel_details`. 3. `revalidatePath`.                                                                                                                                                                                                                  |
| **1.4. Soft Delete Karyawan**        | **Client Component:** Tombol "Arsipkan" + konfirmasi.<br>**Server Action:** `employeeActions.ts`                                                                       | **Mutasi (Server Action):** 1. **Update** `employees`, `users`, dan `employee_personnel_details` dengan `deleted_at: new Date()`. 2. `revalidatePath`.                                                                                                                                                                                   |
| **1.5. Daftar Karyawan Diarsipkan**  | **Server Component:** `app/dashboard/employees/archived/page.tsx`                                                                                                      | **Fetch:** `from('employees').select('*, departments(name)').not('deleted_at', 'is', null).order('deleted_at', { ascending: false })`                                                                                                                                                                                                    |
| **1.6. Manajemen Posisi/Departemen** | **Server Component:** Menampilkan `departments`, `positions`, `position_levels`.<br>**Server Action:** CRUD sederhana untuk tabel master (`departments`, `positions`). | **Fetch/Mutasi:** CRUD dasar pada tabel master.                                                                                                                                                                                                                                                                                          |
| **1.7. Atur Role Pengguna**          | **Client Component:** Dropdown/Modal untuk ganti peran (`role_id`).<br>**Server Action:** `userActions.ts`                                                             | **Mutasi (Server Action):** `update('users', { role_id: newRoleId }).eq('employee_id', employeeId)`.                                                                                                                                                                                                                                     |

## üéì Modul 2: Data Tambahan & Dokumen (Tabel B)

| Fitur                               | Komponen Kunci & Tugas                                                                                                   | Data Flow / Supabase Query                                                                                                                                           |
| :---------------------------------- | :----------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **2.1. Detail Personal (KTP/PTKP)** | **Server Component:** Menampilkan `employee_personnel_details` pada halaman detail karyawan.                             | **Fetch:** `from('employee_personnel_details').select('*').eq('employee_id', id)`.                                                                                   |
| **2.2. Manajemen Pendidikan**       | **Client Component:** Form Tambah/Edit pendidikan.<br>**Server Action:** `educationActions.ts`                           | **Mutasi (Server Action):** **Insert/Update/Delete** pada `employee_educations`. Wajib cek `employee_id` sesuai sesi pengguna atau memiliki _role_ Admin/HR.         |
| **2.3. Manajemen Dokumen**          | **Client Component:** Form _upload_ file + integrasi dengan Supabase Storage.<br>**Server Action:** `documentActions.ts` | **Mutasi (Server Action):** 1. **Upload File** ke Supabase Storage. 2. **Insert** metadata ke `employee_documents` (`file_path` = URL Storage). 3. `revalidatePath`. |

## ‚è∞ Modul 3: Presensi & Lokasi (Tabel C)

| Fitur                               | Komponen Kunci & Tugas                                                                                               | Data Flow / Supabase Query                                                                                                                                     |
| :---------------------------------- | :------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **3.1. Daftar Presensi Harian**     | **Server Component:** Menampilkan tabel `attendances` (dengan filter Tanggal/Lokasi).                                | **Fetch:** `from('attendances').select('*, employees(full_name), locations(name)').is('deleted_at', null).gte('check_in', startDate).lte('check_in', endDate)` |
| **3.2. Manajemen Lokasi & WiFi**    | **Server Component:** Menampilkan tabel `locations` & `location_wifi`.<br>**Server Action:** CRUD untuk kedua tabel. | **Mutasi (Server Action):** CRUD dasar pada `locations` dan `location_wifi`.                                                                                   |
| **3.3. Pengaturan Aturan Presensi** | **Server Component/Action:** CRUD untuk `attendance_rules`.                                                          | **Fetch/Mutasi:** CRUD dasar pada `attendance_rules`.                                                                                                          |
| **3.4. Log Audit Sistem**           | **Server Component:** Menampilkan tabel `audit_logs` (read-only).                                                    | **Fetch:** `from('audit_logs').select('*, users(username)').order('created_at', { ascending: false }).limit(100)`                                              |
| **3.5. Log Aktivitas Karyawan**     | **Server Component:** Menampilkan tabel `activity_logs` (read-only).                                                 | **Fetch:** `from('activity_logs').select('*, employees(full_name)').order('created_at', { ascending: false }).limit(100)`                                      |

## üå¥ Modul 4: Cuti dan Persetujuan (Tabel D)

| Fitur                                   | Komponen Kunci & Tugas                                                                                                | Data Flow / Supabase Query                                                                                                                                                                                                                           |
| :-------------------------------------- | :-------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **4.1. Permintaan Cuti Pending**        | **Server Component:** Menampilkan tabel `leave_requests` dan `business_trips`.                                        | **Fetch:** `from('leave_requests').select('*, employees(full_name)').eq('status', 'Pending').is('deleted_at', null)`                                                                                                                                 |
| **4.2. Aksi Persetujuan/Penolakan**     | **Client Component:** Tombol "Approve/Reject" + modal input catatan.<br>**Server Action:** `approvalActions.ts`       | **Mutasi (Server Action):** 1. **Update** `leave_requests` (atau `business_trips`) dengan `status` dan `approver_id`. 2. **Insert** log ke `approval_histories`. 3. **Insert** ke `notification_templates` (pemicu notifikasi). 4. `revalidatePath`. |
| **4.3. Konfigurasi Alur Persetujuan**   | **Client Component:** UI untuk membuat/mengedit level alur (`approval_flows`).<br>**Server Action:** `flowActions.ts` | **Mutasi (Server Action):** **Insert/Update/Delete** pada `approval_flows`. Wajib menjaga konsistensi relasi `next_level_id`.                                                                                                                        |
| **4.4. Manajemen Kebijakan Cuti/Dinas** | **Server Component/Action:** CRUD untuk `leave_policies` dan `business_trip_policies`.                                | **Fetch/Mutasi:** CRUD dasar pada kedua tabel.                                                                                                                                                                                                       |

## üí∏ Modul 5: Penggajian (Payroll) (Tabel E)

| Fitur                            | Komponen Kunci & Tugas                                                                                 | Data Flow / Supabase Query                                                                                                                                          |
| :------------------------------- | :----------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **5.1. Daftar Periode Gaji**     | **Server Component:** Menampilkan tabel `payroll_periods`.                                             | **Fetch:** `from('payroll_periods').select('*, company_id(name)').order('year', 'month')`                                                                           |
| **5.2. Detail Slip Gaji**        | **Server Component:** Halaman detail per `payroll_period_id`.                                          | **Fetch:** `from('salaries').select('*, employee(full_name), payroll_periods(month, year), salary_details(*, pay_components(name, type)))` per `payroll_period_id`. |
| **5.3. Manajemen Komponen Gaji** | **Server Component:** Menampilkan `pay_components`.<br>**Server Action:** CRUD untuk `pay_components`. | **Mutasi (Server Action):** **Insert/Update/Delete** pada `pay_components`.                                                                                         |
| **5.4. Pengaturan BPJS & Pajak** | **Server Component/Action:** CRUD untuk `bpjs_settings` dan `tax_settings`.                            | **Fetch/Mutasi:** CRUD dasar pada kedua tabel.                                                                                                                      |
| **5.5. Manajemen Kontrak**       | **Server Component/Action:** CRUD untuk `employee_contracts` (pada halaman detail karyawan).           | **Mutasi (Server Action):** **Insert/Update** `employee_contracts`.                                                                                                 |

## üîî Modul 6: Notifikasi & Komunikasi (Tabel F)

| Fitur                                  | Komponen Kunci & Tugas                                                                                                 | Data Flow / Supabase Query                                                                                       |
| :------------------------------------- | :--------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------- |
| **6.1. Log WhatsApp Onboarding**       | **Server Component:** Menampilkan tabel `whatsapp_logs`.                                                               | **Fetch:** `from('whatsapp_logs').select('*, users(username)').order('sent_at', { ascending: false }).limit(50)` |
| **6.2. Manajemen Template Notifikasi** | **Server Component:** Menampilkan `notification_templates`.<br>**Server Action:** CRUD untuk `notification_templates`. | **Mutasi (Server Action):** **Insert/Update/Delete** pada `notification_templates`.                              |
| **6.3. Audit Perangkat Pengguna**      | **Server Component:** Menampilkan tabel `user_devices` dan `user_pins`.                                                | **Fetch:** `from('user_devices').select('*, users(username)')`                                                   |
| **6.4. Status Token Onboarding**       | **Server Component:** Menampilkan tabel `onboarding_tokens` (token yang belum kadaluarsa).                             | **Fetch:** `from('onboarding_tokens').select('*, users(username)').gte('expires_at', NOW())`                     |

```eof

```
